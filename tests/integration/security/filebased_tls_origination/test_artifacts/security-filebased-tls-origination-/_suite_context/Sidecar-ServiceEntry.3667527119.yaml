apiVersion: networking.istio.io/v1alpha3
kind: Sidecar
metadata:
  name: restrict-to-namespace
spec:
  egress:
  - hosts:
    - "istio-system/*"

    - "aks-istio-system/*"

    - "appns-1-86680/*"

    - "serverns-2-64913/*"

    - "external-3-88065/*"
---
apiVersion: networking.istio.io/v1alpha3
kind: ServiceEntry
metadata:
  name: external-service
spec:
  exportTo: [.]
  hosts:
  - fake.external.com
  location: MESH_EXTERNAL
  resolution: DNS
  endpoints:
  - address: external.external-3-88065.svc.cluster.local
  ports:
  - name: http-tls-origination
    number: 8888
    protocol: http
    targetPort: 443
  - name: http2-tls-origination
    number: 8882
    protocol: http2
    targetPort: 443
  - name: http
    number: 80
    protocol: "HTTP"
  - name: grpc
    number: 7070
    protocol: "GRPC"
  - name: http2
    number: 85
    protocol: "HTTP"
  - name: tcp
    number: 9090
    protocol: "TCP"
  - name: https
    number: 443
    protocol: "HTTPS"
  - name: tcp-server
    number: 9091
    protocol: "TCP"
  - name: auto-tcp
    number: 9092
    protocol: ""
  - name: auto-tcp-server
    number: 9093
    protocol: ""
  - name: auto-http
    number: 81
    protocol: ""
  - name: auto-grpc
    number: 7071
    protocol: ""
  - name: auto-https
    number: 9443
    protocol: ""
  - name: http-instance
    number: 82
    protocol: "HTTP"
  - name: http-localhost
    number: 84
    protocol: "HTTP"
  - name: tcp-for-http
    number: 86
    protocol: "HTTP"