# instance configuration for template 'metric'
apiVersion: "config.istio.io/v1alpha2"
kind: metric
metadata:
 name: cloudwatchrequestcount
 namespace: istio-system
spec:
 value: "1"
 dimensions:
   target: destination.service | "unknown"
   service: destination.labels["app"] | "unknown"
   response_code: response.code | 200
   time: request.time
---
# handler configuration for adapter 'metric'
apiVersion: "config.istio.io/v1alpha2"
kind: cloudwatch
metadata:
 name: hndlrTest
 namespace: istio-system
spec:
 namespace: "mixer-CloudWatch"
 metricInfo:
   cloudwatchrequestcount.metric.istio-system:
     unit: Count
     storageResolution: 1 #high resolution metric
---
# rule to dispatch to your handler
apiVersion: "config.istio.io/v1alpha2"
kind: rule
metadata:
 name: mysamplerule
 namespace: istio-system
spec:
 match: "true"
 actions:
 - handler: hndlrTest.cloudwatch
   instances:
   - cloudwatchrequestcount.metric
