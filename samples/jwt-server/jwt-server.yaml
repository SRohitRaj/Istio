# Copyright Istio Authors
#
#   Licensed under the Apache License, Version 2.0 (the "License");
#   you may not use this file except in compliance with the License.
#   You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#   Unless required by applicable law or agreed to in writing, software
#   distributed under the License is distributed on an "AS IS" BASIS,
#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#   See the License for the specific language governing permissions and
#   limitations under the License.

# Example configurations for deploying a jwt-server server separately in the mesh.

apiVersion: v1
kind: Service
metadata:
  name: jwt-server
  labels:
    app: jwt-server
spec:
  ports:
  - name: http
    port: 8000
    targetPort: 8000
  - name: https
    port: 8443
    targetPort: 8443
  selector:
    app: jwt-server
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: jwt-server-cert-key
data:
  example.crt: |
    -----BEGIN CERTIFICATE-----
    MIIFWzCCA0OgAwIBAgIUKjcItCnjnZh6krEAQ51wQD1OazEwDQYJKoZIhvcNAQEL
    BQAwPTELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkFaMSEwHwYDVQQKDBhJbnRlcm5l
    dCBXaWRnaXRzIFB0eSBMdGQwHhcNMjExMDE0MjE1NDA0WhcNMzExMDEyMjE1NDA0
    WjA9MQswCQYDVQQGEwJVUzELMAkGA1UECAwCQVoxITAfBgNVBAoMGEludGVybmV0
    IFdpZGdpdHMgUHR5IEx0ZDCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIB
    AMUVfBzCwzL/eZdsrwni2gyqlkZ2gKJiuQOL33/lHmFpSnRRnHn2GHtfoACz0xOS
    ABcEiJlxCuR+gnWBL7/KneUVNXgdW0BogdINtFcjPpmH3mck5FxpJozly+wXJ+Wx
    Wjmej+esS9pLK7gP22O48fjlznZR+sMgwb8V6Hob0EN1eurV6QvjDa8JiXomSbCK
    bbsGK6y9sE0JVojXMyEg3uXB7u9KHtZ5Haxn34nQsUauhjnZnDMt6ACaXxLhdVnF
    3CcjN2kZVwZIrWGkArgeq3vweBoIoyLMBI3qm7eWldi0EwVStEzdn6Fehu0iD/PE
    TTo6wnFErg6+6hBTSwRPdKpBd3OtSfZEzhckQOgB9SskvKI0J1yr3VTbTw4+cbKr
    NNvl0NQ7Wk3iv9aShdFn1urrkg6Ti8SDetOhJv77YWmjTXN5gbus6aHg2BtJDwhz
    7TSMfUjdap3DNYrUqOVUVnOTuSwOodZU3iD+earzpBhHSLEDOSjpwwJP5qrvhRbw
    H1lHlG61vrFudTGfHAGNxfxcbFdP/Yyc/R1emRF6SZMSwUiz8PFQsioP3nX4Dwba
    Gjq6ofjizq7DJmxxnEoVpn1ZyQiqRP7PwI19jKwJ7pJKWHHhoJ0Ln4pq2OJZxdaJ
    a93KPlktMcqs3G27Jtml6t9fHXdAMfgc9FD/2dIS1Ad3AgMBAAGjUzBRMB0GA1Ud
    DgQWBBTX8e4cbw/8lytbNvbW1reoXxcjVzAfBgNVHSMEGDAWgBTX8e4cbw/8lytb
    NvbW1reoXxcjVzAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3DQEBCwUAA4ICAQCw
    5TnKG8RwPGfrD29iI3yHZFT6L3CD34i82W4fANSWOqDmxcl6QhpoRhp+jV+VIGXb
    MvOzN2e9eER4f1bh9YQ+jmdnfo91MIVzrOfCJVFP9Bz0nt3oa6sklQDYIicfMAav
    g26iCdALhob0vKqd92Wjwz8iP0Z4YV9x6c9PJOp5AOaezlc7XFKiCBZWbZEmfOJV
    41PyVDKRPdtXs1iexiGz82eyqgD8DtF5rglwQYAXDDPgJyq2h8HTv2f4Acsx23my
    6txoYhG6jeNxzuvo1om5ZGwNkUsS0IoKEjIp8E+lB5r/NLyJ789rDzE2HgH9Ikuf
    fwWn0woFKkxO1P4b4I7KkHXh5iDb1nk/tGm6MVlW7i7o1f3Jwa0KiPfY7xtFNPRZ
    SaL1JIMCcjorniLIHtO4yzaPtGn/Ez/QEvdKNqkun49yuiTjWA4mPhpLUPg6IBNX
    XaBsc2QvnZ/UYNibjZh9gby5o45K1VTnANwRA+mRWhpw8DLqex+nq2amz8TW1UKr
    /6OmSozSOPVOGSVkeq952ez6l6cN42WMRMIUINPOmdkCuVhBhHEbmAKgi5h/QC+/
    mq3CvevR8w/KbjmGLOYeSrZQOwbepg4kTSDlwtdoUhclwpZXJiqtM/f33R8eGpUD
    sg782LeVfPVL80R2C8luqfxPCm4J0AWu7VdGPjOV3g==
    -----END CERTIFICATE-----
  example.key: |
    -----BEGIN PRIVATE KEY-----
    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
    mPhtaOaAGSussdbERY/v30vDBg//Qf8=
    -----END PRIVATE KEY-----

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: jwt-server
spec:
  replicas: 1
  selector:
    matchLabels:
      app: jwt-server
  template:
    metadata:
      labels:
        app: jwt-server
    spec:
      containers:
      - image: docker.io/istio/jwt-server:0.5
        imagePullPolicy: IfNotPresent
        name: jwt-server
        volumeMounts:
          - name: certkeyresource
            mountPath: "/app/https/resources"
        args: ["-https", "8443", "-cert", "/app/https/resources/example.crt", "-key", "/app/https/resources/example.key"]
        ports:
        - containerPort: 8000
        - containerPort: 8443
      volumes:
      - name: certkeyresource
        configMap:
          name: jwt-server-cert-key
---
