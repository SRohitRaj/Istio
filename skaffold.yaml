# Skaffold
# Ref: https://skaffold.dev/
# Istio components can be installed seperately through profiles
# Install CRD's and istiod run 'skaffold run'
# Install ingress and egress run 'skaffold run -p ingress,egress'

apiVersion: skaffold/v2beta22
kind: Config
deploy:
  helm:
    releases:
    - name: base        
      chartPath: manifests/charts/base
      namespace: istio-system
      createNamespace: true
    - name: istiod
      chartPath:  manifests/charts/istio-control/istio-discovery
      namespace: istio-system
      createNamespace: true
profiles:
  - name: ingress
    deploy:
      helm:
        releases:
        - name: istio-ingressgateway
          chartPath: manifests/charts/gateways/istio-ingress
          namespace: istio-ingressgateway
          createNamespace: true
  - name: egress
    deploy:
      helm:
        releases:
          - name: istio-egressgateway
            chartPath: manifests/charts/gateways/istio-egress
            namespace: istio-egressgateway
            createNamespace: true
